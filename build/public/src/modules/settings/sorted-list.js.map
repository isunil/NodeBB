{"version":3,"sources":["public/src/modules/settings/sorted-list.js"],"names":["define","benchpress","SortedList","Settings","types","use","this","set","$container","values","key","attr","find","each","idx","item","itemUUID","$","formData","push","helper","serializeForm","get","$list","formTpl","parse","formHtml","addBtn","on","modal","bootbox","confirm","save","utils","generateUUID","form","append","children","hide","data","list","ajaxify","settings","Array","isArray","forEach","deserialize","sortable","addClass","setupRemoveButton","removeBtn","remove","setupEditButton","itemTpl","editBtn","clone","show","itemHtml","oldItem","after"],"mappings":"AAAA,aAEAA,OAAO,wBAAyB,aAAc,YAAa,SAAUC,GACpE,IAAIC,EACJ,IAAIC,EAGJD,GACCE,OAAQ,eACRC,IAAK,WACJF,EAAWG,MAEZC,IAAK,SAAUC,EAAYC,GAC1B,IAAIC,EAAMF,EAAWG,KAAK,oBAE1BF,EAAOC,MACPF,EAAWI,KAAK,sBAAsBC,KAAK,SAAUC,EAAKC,GACzD,IAAIC,EAAWC,EAAEF,GAAMJ,KAAK,yBAE5B,IAAIO,EAAWD,EAAE,6BAA+BP,EAAM,6BAA+BM,EAAW,MAChGP,EAAOC,GAAKS,KAAKhB,EAASiB,OAAOC,cAAcH,OAGjDI,IAAK,SAAUd,GACd,IAAIe,EAAQf,EAAWI,KAAK,sBAC5B,IAAIF,EAAMF,EAAWG,KAAK,oBAC1B,IAAIa,EAAUhB,EAAWG,KAAK,sBAE9BV,EAAWwB,MAAMD,KAAa,SAAUE,GACvC,IAAIC,EAASV,EAAE,sBAAwBP,EAAM,wBAE7CiB,EAAOC,GAAG,QAAS,WAClB,IAAIC,EAAQC,QAAQC,QAAQL,EAAU,SAAUM,GAC/C,GAAIA,EAAM,CACT,IAAIhB,EAAWiB,MAAMC,eACrB,IAAIC,EAAOlB,EAAE,yCAA2CD,EAAW,8BAAgCN,EAAM,QACzGyB,EAAKC,OAAOP,EAAMjB,KAAK,QAAQyB,YAE/BpB,EAAE,YAAYmB,OAAOD,EAAKG,QAG1B,IAAIC,EAAOpC,EAASiB,OAAOC,cAAcc,GACzCV,EAAMjB,EAAYQ,EAAUuB,QAK/B,IAAIC,EAAOC,QAAQF,KAAKG,SAAShC,GACjC,GAAIiC,MAAMC,QAAQJ,WAAgBA,EAAK,KAAO,SAAU,CACvDA,EAAKK,QAAQ,SAAU9B,GACtB,IAAIC,EAAWiB,MAAMC,eACrB,IAAIC,EAAOlB,EAAES,GAAUoB,YAAY/B,GACnCoB,EAAKxB,KAAK,wBAAyBK,GACnCmB,EAAKxB,KAAK,0BAA2BD,GACrCO,EAAE,YAAYmB,OAAOD,EAAKG,QAE1Bb,EAAMjB,EAAYQ,EAAUD,QAK/BQ,EAAMwB,WAAWC,SAAS,aAI5B,SAASC,EAAkBzC,EAAYQ,GACtC,IAAIN,EAAMF,EAAWG,KAAK,oBAE1B,IAAIuC,EAAYjC,EAAE,sBAAwBP,EAAM,2BAChDwC,EAAUtB,GAAG,QAAS,WACrBX,EAAE,2BAA6BD,EAAW,MAAMmC,WAIlD,SAASC,EAAgB5C,EAAYQ,GACpC,IAAIO,EAAQf,EAAWI,KAAK,sBAC5B,IAAIF,EAAMF,EAAWG,KAAK,oBAC1B,IAAI0C,EAAU7C,EAAWG,KAAK,sBAC9B,IAAI2C,EAAUrC,EAAE,2BAA6BD,EAAW,yBAExDsC,EAAQ1B,GAAG,QAAS,WACnB,IAAIO,EAAOlB,EAAE,2BAA6BD,EAAW,+BAAiCN,EAAM,MAAM6C,MAAM,MAAMC,OAE9G,IAAI3B,EAAQC,QAAQC,QAAQI,EAAM,SAAUH,GAC3C,GAAIA,EAAM,CACT,IAAIG,EAAOlB,EAAE,yCAA2CD,EAAW,8BAAgCN,EAAM,QACzGyB,EAAKC,OAAOP,EAAMjB,KAAK,QAAQyB,YAE/BpB,EAAE,YAAYL,KAAK,2BAA6BI,EAAW,+BAAiCN,EAAM,MAAMyC,SACxGlC,EAAE,YAAYmB,OAAOD,EAAKG,QAG1B,IAAIC,EAAOpC,EAASiB,OAAOC,cAAcc,GAEzClC,EAAWwB,MAAM4B,EAASd,EAAM,SAAUkB,GACzCA,EAAWxC,EAAEwC,GACb,IAAIC,EAAUnC,EAAMX,KAAK,2BAA6BI,EAAW,MACjE0C,EAAQC,MAAMF,GACdC,EAAQP,SACRM,EAAS9C,KAAK,wBAAyBK,GAEvCiC,EAAkBzC,EAAYQ,GAC9BoC,EAAgB5C,EAAYQ,UAOjC,SAASS,EAAMjB,EAAYQ,EAAUuB,GACpC,IAAIhB,EAAQf,EAAWI,KAAK,sBAC5B,IAAIyC,EAAU7C,EAAWG,KAAK,sBAE9BV,EAAWwB,MAAM4B,EAASd,EAAM,SAAUkB,GACzCA,EAAWxC,EAAEwC,GACblC,EAAMa,OAAOqB,GACbA,EAAS9C,KAAK,wBAAyBK,GAEvCiC,EAAkBzC,EAAYQ,GAC9BoC,EAAgB5C,EAAYQ,KAI9B,OAAOd","file":"public/src/modules/settings/sorted-list.js","sourcesContent":["'use strict';\r\n\r\ndefine('settings/sorted-list', ['benchpress', 'jqueryui'], function (benchpress) {\r\n\tvar SortedList;\r\n\tvar Settings;\r\n\r\n\r\n\tSortedList = {\r\n\t\ttypes: ['sorted-list'],\r\n\t\tuse: function () {\r\n\t\t\tSettings = this;\r\n\t\t},\r\n\t\tset: function ($container, values) {\r\n\t\t\tvar key = $container.attr('data-sorted-list');\r\n\r\n\t\t\tvalues[key] = [];\r\n\t\t\t$container.find('[data-type=\"item\"]').each(function (idx, item) {\r\n\t\t\t\tvar itemUUID = $(item).attr('data-sorted-list-uuid');\r\n\r\n\t\t\t\tvar formData = $('[data-sorted-list-object=\"' + key + '\"][data-sorted-list-uuid=\"' + itemUUID + '\"]');\r\n\t\t\t\tvalues[key].push(Settings.helper.serializeForm(formData));\r\n\t\t\t});\r\n\t\t},\r\n\t\tget: function ($container) {\r\n\t\t\tvar $list = $container.find('[data-type=\"list\"]');\r\n\t\t\tvar key = $container.attr('data-sorted-list');\r\n\t\t\tvar formTpl = $container.attr('data-form-template');\r\n\r\n\t\t\tbenchpress.parse(formTpl, {}, function (formHtml) {\r\n\t\t\t\tvar addBtn = $('[data-sorted-list=\"' + key + '\"] [data-type=\"add\"]');\r\n\r\n\t\t\t\taddBtn.on('click', function () {\r\n\t\t\t\t\tvar modal = bootbox.confirm(formHtml, function (save) {\r\n\t\t\t\t\t\tif (save) {\r\n\t\t\t\t\t\t\tvar itemUUID = utils.generateUUID();\r\n\t\t\t\t\t\t\tvar form = $('<form class=\"\" data-sorted-list-uuid=\"' + itemUUID + '\" data-sorted-list-object=\"' + key + '\" />');\r\n\t\t\t\t\t\t\tform.append(modal.find('form').children());\r\n\r\n\t\t\t\t\t\t\t$('#content').append(form.hide());\r\n\r\n\r\n\t\t\t\t\t\t\tvar data = Settings.helper.serializeForm(form);\r\n\t\t\t\t\t\t\tparse($container, itemUUID, data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tvar list = ajaxify.data.settings[key];\r\n\t\t\t\tif (Array.isArray(list) && typeof list[0] !== 'string') {\r\n\t\t\t\t\tlist.forEach(function (item) {\r\n\t\t\t\t\t\tvar itemUUID = utils.generateUUID();\r\n\t\t\t\t\t\tvar form = $(formHtml).deserialize(item);\r\n\t\t\t\t\t\tform.attr('data-sorted-list-uuid', itemUUID);\r\n\t\t\t\t\t\tform.attr('data-sorted-list-object', key);\r\n\t\t\t\t\t\t$('#content').append(form.hide());\r\n\r\n\t\t\t\t\t\tparse($container, itemUUID, item);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$list.sortable().addClass('pointer');\r\n\t\t},\r\n\t};\r\n\r\n\tfunction setupRemoveButton($container, itemUUID) {\r\n\t\tvar key = $container.attr('data-sorted-list');\r\n\r\n\t\tvar removeBtn = $('[data-sorted-list=\"' + key + '\"] [data-type=\"remove\"]');\r\n\t\tremoveBtn.on('click', function () {\r\n\t\t\t$('[data-sorted-list-uuid=\"' + itemUUID + '\"]').remove();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction setupEditButton($container, itemUUID) {\r\n\t\tvar $list = $container.find('[data-type=\"list\"]');\r\n\t\tvar key = $container.attr('data-sorted-list');\r\n\t\tvar itemTpl = $container.attr('data-item-template');\r\n\t\tvar editBtn = $('[data-sorted-list-uuid=\"' + itemUUID + '\"] [data-type=\"edit\"]');\r\n\r\n\t\teditBtn.on('click', function () {\r\n\t\t\tvar form = $('[data-sorted-list-uuid=\"' + itemUUID + '\"][data-sorted-list-object=\"' + key + '\"]').clone(true).show();\r\n\r\n\t\t\tvar modal = bootbox.confirm(form, function (save) {\r\n\t\t\t\tif (save) {\r\n\t\t\t\t\tvar form = $('<form class=\"\" data-sorted-list-uuid=\"' + itemUUID + '\" data-sorted-list-object=\"' + key + '\" />');\r\n\t\t\t\t\tform.append(modal.find('form').children());\r\n\r\n\t\t\t\t\t$('#content').find('[data-sorted-list-uuid=\"' + itemUUID + '\"][data-sorted-list-object=\"' + key + '\"]').remove();\r\n\t\t\t\t\t$('#content').append(form.hide());\r\n\r\n\r\n\t\t\t\t\tvar data = Settings.helper.serializeForm(form);\r\n\r\n\t\t\t\t\tbenchpress.parse(itemTpl, data, function (itemHtml) {\r\n\t\t\t\t\t\titemHtml = $(itemHtml);\r\n\t\t\t\t\t\tvar oldItem = $list.find('[data-sorted-list-uuid=\"' + itemUUID + '\"]');\r\n\t\t\t\t\t\toldItem.after(itemHtml);\r\n\t\t\t\t\t\toldItem.remove();\r\n\t\t\t\t\t\titemHtml.attr('data-sorted-list-uuid', itemUUID);\r\n\r\n\t\t\t\t\t\tsetupRemoveButton($container, itemUUID);\r\n\t\t\t\t\t\tsetupEditButton($container, itemUUID);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction parse($container, itemUUID, data) {\r\n\t\tvar $list = $container.find('[data-type=\"list\"]');\r\n\t\tvar itemTpl = $container.attr('data-item-template');\r\n\r\n\t\tbenchpress.parse(itemTpl, data, function (itemHtml) {\r\n\t\t\titemHtml = $(itemHtml);\r\n\t\t\t$list.append(itemHtml);\r\n\t\t\titemHtml.attr('data-sorted-list-uuid', itemUUID);\r\n\r\n\t\t\tsetupRemoveButton($container, itemUUID);\r\n\t\t\tsetupEditButton($container, itemUUID);\r\n\t\t});\r\n\t}\r\n\r\n\treturn SortedList;\r\n});\r\n"]}