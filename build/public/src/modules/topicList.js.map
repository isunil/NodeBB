{"version":3,"sources":["public/src/modules/topicList.js"],"names":["define","infinitescroll","handleBack","topicSelect","categorySearch","TopicList","templateName","tplToSort","recent","unread","popular","top","newTopicCount","newPostCount","loadTopicsCallback","topicListEl","$","window","on","removeListeners","init","template","cb","findTopicListElement","loadTopicsAfter","watchForNewPosts","handleCategorySelection","config","usePagination","loadMoreTopics","after","handleBackCallback","data","loadCallback","onTopicsLoaded","topics","ajaxify","showSelect","height","children","length","show","trigger","filter","i","e","parents","this","addClass","socket","onNewTopic","onNewPost","removeListener","isCategoryVisible","cid","categories","some","c","parseInt","selectedCids","indexOf","selectedFilter","category","updateAlertText","post","posts","topic","isFollowing","mainPid","pid","text","translateText","removeClass","fadeIn","getSelectedCids","cids","each","index","el","find","push","attr","sort","a","b","changed","forEach","url","location","pathname","currentParams","utils","params","decodeURIComponent","param","go","ev","selectChildren","parentCid","flag","toggleClass","categoryEl","ctrlKey","hasClass","first","direction","afterEl","last","isNumber","done","callback","query","loadMore","count","topicsPerPage","term","selectedTerm","set","filterTopicsOnDom","tid","hide","before","topicEls","tplData","name","app","parseAndTranslate","html","remove","insertAfter","document","scrollTop","insertBefore","append","getSelectedTids","removeExtra","timeago","createUserTooltips","makeNumbersHumanReadable"],"mappings":"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","file":"public/src/modules/topicList.js","sourcesContent":["'use strict';\r\n\r\ndefine('topicList', [\r\n\t'forum/infinitescroll',\r\n\t'handleBack',\r\n\t'topicSelect',\r\n\t'categorySearch',\r\n], function (infinitescroll, handleBack, topicSelect, categorySearch) {\r\n\tvar TopicList = {};\r\n\tvar templateName = '';\r\n\r\n\tvar tplToSort = {\r\n\t\trecent: 'recent',\r\n\t\tunread: 'unread',\r\n\t\tpopular: 'posts',\r\n\t\ttop: 'votes',\r\n\t};\r\n\r\n\tvar newTopicCount = 0;\r\n\tvar newPostCount = 0;\r\n\r\n\tvar loadTopicsCallback;\r\n\tvar topicListEl;\r\n\r\n\t$(window).on('action:ajaxify.start', function () {\r\n\t\tTopicList.removeListeners();\r\n\t});\r\n\r\n\tTopicList.init = function (template, cb) {\r\n\t\ttopicListEl = findTopicListElement();\r\n\r\n\t\ttemplateName = template;\r\n\t\tloadTopicsCallback = cb || loadTopicsAfter;\r\n\r\n\t\tTopicList.watchForNewPosts();\r\n\r\n\t\tTopicList.handleCategorySelection();\r\n\r\n\t\tif (!config.usePagination) {\r\n\t\t\tinfinitescroll.init(TopicList.loadMoreTopics);\r\n\t\t}\r\n\r\n\t\thandleBack.init(function (after, handleBackCallback) {\r\n\t\t\tloadTopicsCallback(after, 1, function (data, loadCallback) {\r\n\t\t\t\tTopicList.onTopicsLoaded(templateName, data.topics, ajaxify.data.showSelect, 1, function () {\r\n\t\t\t\t\thandleBackCallback();\r\n\t\t\t\t\tloadCallback();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif ($('body').height() <= $(window).height() && topicListEl.children().length >= 20) {\r\n\t\t\t$('#load-more-btn').show();\r\n\t\t}\r\n\r\n\t\t$('#load-more-btn').on('click', function () {\r\n\t\t\tTopicList.loadMoreTopics(1);\r\n\t\t});\r\n\r\n\t\t$(window).trigger('action:topics.loaded', { topics: ajaxify.data.topics });\r\n\t};\r\n\r\n\tfunction findTopicListElement() {\r\n\t\treturn $('[component=\"category\"]').filter(function (i, e) {\r\n\t\t\treturn !$(e).parents('[widget-area],[data-widget-area]').length;\r\n\t\t});\r\n\t}\r\n\r\n\tTopicList.watchForNewPosts = function () {\r\n\t\t$('#new-topics-alert').on('click', function () {\r\n\t\t\t$(this).addClass('hide');\r\n\t\t});\r\n\t\tnewPostCount = 0;\r\n\t\tnewTopicCount = 0;\r\n\t\tTopicList.removeListeners();\r\n\t\tsocket.on('event:new_topic', onNewTopic);\r\n\t\tsocket.on('event:new_post', onNewPost);\r\n\t};\r\n\r\n\tTopicList.removeListeners = function () {\r\n\t\tsocket.removeListener('event:new_topic', onNewTopic);\r\n\t\tsocket.removeListener('event:new_post', onNewPost);\r\n\t};\r\n\r\n\tfunction isCategoryVisible(cid) {\r\n\t\treturn ajaxify.data.categories && ajaxify.data.categories.length && ajaxify.data.categories.some(function (c) {\r\n\t\t\treturn parseInt(c.cid, 10) === parseInt(cid, 10);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onNewTopic(data) {\r\n\t\tif (\r\n\t\t\t(ajaxify.data.selectedCids && ajaxify.data.selectedCids.length && ajaxify.data.selectedCids.indexOf(parseInt(data.cid, 10)) === -1) ||\r\n\t\t\t(ajaxify.data.selectedFilter && ajaxify.data.selectedFilter.filter === 'watched') ||\r\n\t\t\t(ajaxify.data.template.category && parseInt(ajaxify.data.cid, 10) !== parseInt(data.cid, 10)) ||\r\n\t\t\t(!isCategoryVisible(data.cid))\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tnewTopicCount += 1;\r\n\t\tupdateAlertText();\r\n\t}\r\n\r\n\tfunction onNewPost(data) {\r\n\t\tvar post = data.posts[0];\r\n\t\tif (!post || !post.topic) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!post.topic.isFollowing && (\r\n\t\t\t(parseInt(post.topic.mainPid, 10) === parseInt(post.pid, 10)) ||\r\n\t\t\t(ajaxify.data.selectedCids && ajaxify.data.selectedCids.length && ajaxify.data.selectedCids.indexOf(parseInt(post.topic.cid, 10)) === -1) ||\r\n\t\t\t(ajaxify.data.selectedFilter && ajaxify.data.selectedFilter.filter === 'new') ||\r\n\t\t\t(ajaxify.data.selectedFilter && ajaxify.data.selectedFilter.filter === 'watched' && !post.topic.isFollowing) ||\r\n\t\t\t(ajaxify.data.template.category && parseInt(ajaxify.data.cid, 10) !== parseInt(post.topic.cid, 10)) ||\r\n\t\t\t(!isCategoryVisible(post.topic.cid))\r\n\t\t)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tnewPostCount += 1;\r\n\t\tupdateAlertText();\r\n\t}\r\n\r\n\tfunction updateAlertText() {\r\n\t\tvar text = '';\r\n\r\n\t\tif (newTopicCount === 0) {\r\n\t\t\tif (newPostCount === 1) {\r\n\t\t\t\ttext = '[[recent:there-is-a-new-post]]';\r\n\t\t\t} else if (newPostCount > 1) {\r\n\t\t\t\ttext = '[[recent:there-are-new-posts, ' + newPostCount + ']]';\r\n\t\t\t}\r\n\t\t} else if (newTopicCount === 1) {\r\n\t\t\tif (newPostCount === 0) {\r\n\t\t\t\ttext = '[[recent:there-is-a-new-topic]]';\r\n\t\t\t} else if (newPostCount === 1) {\r\n\t\t\t\ttext = '[[recent:there-is-a-new-topic-and-a-new-post]]';\r\n\t\t\t} else if (newPostCount > 1) {\r\n\t\t\t\ttext = '[[recent:there-is-a-new-topic-and-new-posts, ' + newPostCount + ']]';\r\n\t\t\t}\r\n\t\t} else if (newTopicCount > 1) {\r\n\t\t\tif (newPostCount === 0) {\r\n\t\t\t\ttext = '[[recent:there-are-new-topics, ' + newTopicCount + ']]';\r\n\t\t\t} else if (newPostCount === 1) {\r\n\t\t\t\ttext = '[[recent:there-are-new-topics-and-a-new-post, ' + newTopicCount + ']]';\r\n\t\t\t} else if (newPostCount > 1) {\r\n\t\t\t\ttext = '[[recent:there-are-new-topics-and-new-posts, ' + newTopicCount + ', ' + newPostCount + ']]';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttext += ' [[recent:click-here-to-reload]]';\r\n\r\n\t\t$('#new-topics-alert').translateText(text).removeClass('hide').fadeIn('slow');\r\n\t\t$('#category-no-topics').addClass('hide');\r\n\t}\r\n\r\n\tTopicList.handleCategorySelection = function () {\r\n\t\tfunction getSelectedCids() {\r\n\t\t\tvar cids = [];\r\n\t\t\t$('[component=\"category/list\"] [data-cid]').each(function (index, el) {\r\n\t\t\t\tif ($(el).find('i.fa-check').length) {\r\n\t\t\t\t\tcids.push(parseInt($(el).attr('data-cid'), 10));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tcids.sort(function (a, b) {\r\n\t\t\t\treturn a - b;\r\n\t\t\t});\r\n\t\t\treturn cids;\r\n\t\t}\r\n\r\n\t\tcategorySearch.init($('[component=\"category/dropdown\"]'));\r\n\r\n\t\t$('[component=\"category/dropdown\"]').on('hidden.bs.dropdown', function () {\r\n\t\t\tvar cids = getSelectedCids();\r\n\t\t\tvar changed = ajaxify.data.selectedCids.length !== cids.length;\r\n\t\t\tajaxify.data.selectedCids.forEach(function (cid, index) {\r\n\t\t\t\tif (cid !== cids[index]) {\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (changed) {\r\n\t\t\t\tvar url = window.location.pathname;\r\n\t\t\t\tvar currentParams = utils.params();\r\n\t\t\t\tif (cids.length) {\r\n\t\t\t\t\tcurrentParams.cid = cids;\r\n\t\t\t\t\turl += '?' + decodeURIComponent($.param(currentParams));\r\n\t\t\t\t}\r\n\t\t\t\tajaxify.go(url);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('[component=\"category/list\"]').on('click', '[data-cid]', function (ev) {\r\n\t\t\tfunction selectChildren(parentCid, flag) {\r\n\t\t\t\t$('[component=\"category/list\"] [data-parent-cid=\"' + parentCid + '\"] [component=\"category/select/icon\"]').toggleClass('fa-check', flag);\r\n\t\t\t\t$('[component=\"category/list\"] [data-parent-cid=\"' + parentCid + '\"]').each(function (index, el) {\r\n\t\t\t\t\tselectChildren($(el).attr('data-cid'), flag);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tvar categoryEl = $(this);\r\n\t\t\tvar cid = $(this).attr('data-cid');\r\n\t\t\tif (ev.ctrlKey) {\r\n\t\t\t\tselectChildren(cid, !categoryEl.find('[component=\"category/select/icon\"]').hasClass('fa-check'));\r\n\t\t\t}\r\n\t\t\tcategoryEl.find('[component=\"category/select/icon\"]').toggleClass('fa-check');\r\n\t\t\t$('[component=\"category/list\"] li').first().find('i').toggleClass('fa-check', !getSelectedCids().length);\r\n\t\t\treturn false;\r\n\t\t});\r\n\t};\r\n\r\n\tTopicList.loadMoreTopics = function (direction) {\r\n\t\tif (!topicListEl.length || !topicListEl.children().length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar topics = topicListEl.find('[component=\"category/topic\"]');\r\n\t\tvar afterEl = direction > 0 ? topics.last() : topics.first();\r\n\t\tvar after = (parseInt(afterEl.attr('data-index'), 10) || 0) + (direction > 0 ? 1 : 0);\r\n\r\n\t\tif (!utils.isNumber(after) || (after === 0 && topicListEl.find('[component=\"category/topic\"][data-index=\"0\"]').length)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tloadTopicsCallback(after, direction, function (data, done) {\r\n\t\t\tTopicList.onTopicsLoaded(templateName, data.topics, ajaxify.data.showSelect, direction, done);\r\n\t\t});\r\n\t};\r\n\r\n\tfunction loadTopicsAfter(after, direction, callback) {\r\n\t\tcallback = callback || function () {};\r\n\t\tvar query = utils.params();\r\n\t\tinfinitescroll.loadMore('topics.loadMoreSortedTopics', {\r\n\t\t\tafter: after,\r\n\t\t\tdirection: direction,\r\n\t\t\tsort: tplToSort[templateName],\r\n\t\t\tcount: config.topicsPerPage,\r\n\t\t\tcid: query.cid,\r\n\t\t\tquery: query,\r\n\t\t\tterm: ajaxify.data.selectedTerm && ajaxify.data.selectedTerm.term,\r\n\t\t\tfilter: ajaxify.data.selectedFilter.filter,\r\n\t\t\tset: topicListEl.attr('data-set') ? topicListEl.attr('data-set') : 'topics:recent',\r\n\t\t}, callback);\r\n\t}\r\n\r\n\tfunction filterTopicsOnDom(topics) {\r\n\t\treturn topics.filter(function (topic) {\r\n\t\t\treturn !topicListEl.find('[component=\"category/topic\"][data-tid=\"' + topic.tid + '\"]').length;\r\n\t\t});\r\n\t}\r\n\r\n\tTopicList.onTopicsLoaded = function (templateName, topics, showSelect, direction, callback) {\r\n\t\tif (!topics || !topics.length) {\r\n\t\t\t$('#load-more-btn').hide();\r\n\t\t\treturn callback();\r\n\t\t}\r\n\t\ttopics = filterTopicsOnDom(topics);\r\n\r\n\t\tif (!topics.length) {\r\n\t\t\t$('#load-more-btn').hide();\r\n\t\t\treturn callback();\r\n\t\t}\r\n\r\n\t\tvar after;\r\n\t\tvar before;\r\n\t\tvar topicEls = topicListEl.find('[component=\"category/topic\"]');\r\n\r\n\t\tif (direction > 0 && topics.length) {\r\n\t\t\tafter = topicEls.last();\r\n\t\t} else if (direction < 0 && topics.length) {\r\n\t\t\tbefore = topicEls.first();\r\n\t\t}\r\n\r\n\t\tvar tplData = {\r\n\t\t\ttopics: topics,\r\n\t\t\tshowSelect: showSelect,\r\n\t\t\ttemplate: {\r\n\t\t\t\tname: templateName,\r\n\t\t\t},\r\n\t\t};\r\n\t\ttplData.template[templateName] = true;\r\n\r\n\t\tapp.parseAndTranslate(templateName, 'topics', tplData, function (html) {\r\n\t\t\ttopicListEl.removeClass('hidden');\r\n\t\t\t$('#category-no-topics').remove();\r\n\r\n\t\t\tif (after && after.length) {\r\n\t\t\t\thtml.insertAfter(after);\r\n\t\t\t} else if (before && before.length) {\r\n\t\t\t\tvar height = $(document).height();\r\n\t\t\t\tvar scrollTop = $(window).scrollTop();\r\n\r\n\t\t\t\thtml.insertBefore(before);\r\n\r\n\t\t\t\t$(window).scrollTop(scrollTop + ($(document).height() - height));\r\n\t\t\t} else {\r\n\t\t\t\ttopicListEl.append(html);\r\n\t\t\t}\r\n\r\n\t\t\tif (!topicSelect.getSelectedTids().length) {\r\n\t\t\t\tinfinitescroll.removeExtra(topicListEl.find('[component=\"category/topic\"]'), direction, config.topicsPerPage * 3);\r\n\t\t\t}\r\n\r\n\t\t\thtml.find('.timeago').timeago();\r\n\t\t\tapp.createUserTooltips(html);\r\n\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\r\n\t\t\t$(window).trigger('action:topics.loaded', { topics: topics, template: templateName });\r\n\t\t\tcallback();\r\n\t\t});\r\n\t};\r\n\r\n\treturn TopicList;\r\n});\r\n"]}