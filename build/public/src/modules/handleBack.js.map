{"version":3,"sources":["public/src/modules/handleBack.js"],"names":["define","components","storage","navigator","pagination","handleBack","loadTopicsMethod","init","_loadTopicsMethod","saveClickedIndex","$","window","off","onBackClicked","on","clickedIndex","this","parents","attr","windowScrollTop","scrollTop","each","index","el","offset","top","setItem","ajaxify","data","template","category","recent","bookmarkIndex","getItem","removeItem","utils","isNumber","Math","max","parseInt","config","usePagination","page","ceil","topicsPerPage","currentPage","loadPage","scrollToTopic","empty","highlightTopic","topicIndex","highlight","get","length","hasClass","addClass","setTimeout","removeClass","scrollTo","update"],"mappings":"AAAA,aAEAA,OAAO,cACN,aACA,UACA,YACA,oBACE,SAAUC,EAAYC,EAASC,EAAWC,GAC5C,IAAIC,KACJ,IAAIC,EAEJD,EAAWE,KAAO,SAAUC,GAC3BF,EAAmBE,EACnBC,IACAC,EAAEC,QAAQC,IAAI,kBAAmBC,GAAeC,GAAG,kBAAmBD,IAGvE,SAASJ,IACRC,EAAE,0BAA0BI,GAAG,QAAS,6BAA8B,WACrE,IAAIC,EAAeL,EAAEM,MAAMC,QAAQ,gBAAgBC,KAAK,cACxD,IAAIC,EAAkBT,EAAEC,QAAQS,YAChCV,EAAE,gCAAgCW,KAAK,SAAUC,EAAOC,GACvD,GAAIb,EAAEa,GAAIC,SAASC,IAAMN,EAAkB,EAAG,CAC7CjB,EAAQwB,QAAQ,oBAAqBhB,EAAEa,GAAIL,KAAK,eAChDhB,EAAQwB,QAAQ,4BAA6BX,GAC7Cb,EAAQwB,QAAQ,2BAA4BhB,EAAEa,GAAIC,SAASC,IAAMN,GACjE,OAAO,WAMX,SAASN,IACR,GAAKc,QAAQC,KAAKC,SAASC,UAAYH,QAAQC,KAAKC,SAASE,OAAS,CACrE,IAAIC,EAAgB9B,EAAQ+B,QAAQ,qBACpC,IAAIlB,EAAeb,EAAQ+B,QAAQ,6BAEnC/B,EAAQgC,WAAW,qBACnBhC,EAAQgC,WAAW,6BACnB,IAAKC,MAAMC,SAASJ,GAAgB,CACnC,OAGDA,EAAgBK,KAAKC,IAAI,EAAGC,SAASP,EAAe,KAAO,GAC3DjB,EAAesB,KAAKC,IAAI,EAAGC,SAASxB,EAAc,KAAO,GAEzD,GAAIyB,OAAOC,cAAe,CACzB,IAAIC,EAAOL,KAAKM,MAAMJ,SAASP,EAAe,IAAM,GAAKQ,OAAOI,eAChE,GAAIL,SAASG,EAAM,MAAQf,QAAQC,KAAKxB,WAAWyC,YAAa,CAC/DzC,EAAW0C,SAASJ,EAAM,WACzBrC,EAAW0C,cAAcf,EAAejB,SAEnC,CACNV,EAAW0C,cAAcf,EAAejB,QAEnC,CACN,GAAIiB,IAAkB,EAAG,CACxB3B,EAAW0C,cAAcf,EAAejB,GACxC,OAGDL,EAAE,0BAA0BsC,QAC5B1C,EAAiB+B,KAAKC,IAAI,EAAGN,EAAgB,GAAK,EAAG,WACpD3B,EAAW0C,cAAcf,EAAejB,OAM5CV,EAAW4C,eAAiB,SAAUC,GACrC,IAAIC,EAAYlD,EAAWmD,IAAI,iBAAkB,QAASF,GAE1D,GAAIC,EAAUE,SAAWF,EAAUG,SAAS,aAAc,CACzDH,EAAUI,SAAS,aACnBC,WAAW,WACVL,EAAUM,YAAY,cACpB,OAILpD,EAAW0C,cAAgB,SAAUf,EAAejB,GACnD,IAAKoB,MAAMC,SAASJ,GAAgB,CACnC,OAGD,IAAI0B,EAAWzD,EAAWmD,IAAI,iBAAkB,QAASpB,GAEzD,GAAI0B,EAASL,OAAQ,CACpB,IAAI7B,EAAStB,EAAQ+B,QAAQ,4BAC7B/B,EAAQgC,WAAW,4BACnBxB,EAAEC,QAAQS,UAAUsC,EAASlC,SAASC,IAAMD,GAC5CnB,EAAW4C,eAAelC,GAC1BZ,EAAUwD,WAIZ,OAAOtD","file":"public/src/modules/handleBack.js","sourcesContent":["'use strict';\r\n\r\ndefine('handleBack', [\r\n\t'components',\r\n\t'storage',\r\n\t'navigator',\r\n\t'forum/pagination',\r\n], function (components, storage, navigator, pagination) {\r\n\tvar handleBack = {};\r\n\tvar loadTopicsMethod;\r\n\r\n\thandleBack.init = function (_loadTopicsMethod) {\r\n\t\tloadTopicsMethod = _loadTopicsMethod;\r\n\t\tsaveClickedIndex();\r\n\t\t$(window).off('action:popstate', onBackClicked).on('action:popstate', onBackClicked);\r\n\t};\r\n\r\n\tfunction saveClickedIndex() {\r\n\t\t$('[component=\"category\"]').on('click', '[component=\"topic/header\"]', function () {\r\n\t\t\tvar clickedIndex = $(this).parents('[data-index]').attr('data-index');\r\n\t\t\tvar windowScrollTop = $(window).scrollTop();\r\n\t\t\t$('[component=\"category/topic\"]').each(function (index, el) {\r\n\t\t\t\tif ($(el).offset().top - windowScrollTop > 0) {\r\n\t\t\t\t\tstorage.setItem('category:bookmark', $(el).attr('data-index'));\r\n\t\t\t\t\tstorage.setItem('category:bookmark:clicked', clickedIndex);\r\n\t\t\t\t\tstorage.setItem('category:bookmark:offset', $(el).offset().top - windowScrollTop);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onBackClicked() {\r\n\t\tif ((ajaxify.data.template.category || ajaxify.data.template.recent)) {\r\n\t\t\tvar bookmarkIndex = storage.getItem('category:bookmark');\r\n\t\t\tvar clickedIndex = storage.getItem('category:bookmark:clicked');\r\n\r\n\t\t\tstorage.removeItem('category:bookmark');\r\n\t\t\tstorage.removeItem('category:bookmark:clicked');\r\n\t\t\tif (!utils.isNumber(bookmarkIndex)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbookmarkIndex = Math.max(0, parseInt(bookmarkIndex, 10) || 0);\r\n\t\t\tclickedIndex = Math.max(0, parseInt(clickedIndex, 10) || 0);\r\n\r\n\t\t\tif (config.usePagination) {\r\n\t\t\t\tvar page = Math.ceil((parseInt(bookmarkIndex, 10) + 1) / config.topicsPerPage);\r\n\t\t\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\r\n\t\t\t\t\tpagination.loadPage(page, function () {\r\n\t\t\t\t\t\thandleBack.scrollToTopic(bookmarkIndex, clickedIndex);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\thandleBack.scrollToTopic(bookmarkIndex, clickedIndex);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (bookmarkIndex === 0) {\r\n\t\t\t\t\thandleBack.scrollToTopic(bookmarkIndex, clickedIndex);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$('[component=\"category\"]').empty();\r\n\t\t\t\tloadTopicsMethod(Math.max(0, bookmarkIndex - 1) + 1, function () {\r\n\t\t\t\t\thandleBack.scrollToTopic(bookmarkIndex, clickedIndex);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thandleBack.highlightTopic = function (topicIndex) {\r\n\t\tvar highlight = components.get('category/topic', 'index', topicIndex);\r\n\r\n\t\tif (highlight.length && !highlight.hasClass('highlight')) {\r\n\t\t\thighlight.addClass('highlight');\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\thighlight.removeClass('highlight');\r\n\t\t\t}, 5000);\r\n\t\t}\r\n\t};\r\n\r\n\thandleBack.scrollToTopic = function (bookmarkIndex, clickedIndex) {\r\n\t\tif (!utils.isNumber(bookmarkIndex)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar scrollTo = components.get('category/topic', 'index', bookmarkIndex);\r\n\r\n\t\tif (scrollTo.length) {\r\n\t\t\tvar offset = storage.getItem('category:bookmark:offset');\r\n\t\t\tstorage.removeItem('category:bookmark:offset');\r\n\t\t\t$(window).scrollTop(scrollTo.offset().top - offset);\r\n\t\t\thandleBack.highlightTopic(clickedIndex);\r\n\t\t\tnavigator.update();\r\n\t\t}\r\n\t};\r\n\r\n\treturn handleBack;\r\n});\r\n"]}