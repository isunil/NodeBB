{"version":3,"sources":["public/src/client/category.js"],"names":["define","infinitescroll","share","navigator","categoryTools","topicList","sort","Category","$","window","on","ev","data","String","url","startsWith","disable","removeListeners","init","cid","ajaxify","app","enterRoom","addShareHandlers","name","loadTopicsAfter","handleSort","slug","config","usePagination","topic_count","toTop","toBottom","navigatorCallback","handleScrollToTopicIndex","handleIgnoreWatch","trigger","topics","parts","location","pathname","split","topicIndex","length","utils","isNumber","Math","max","parseInt","search","indexOf","scrollToElement","$this","this","state","attr","socket","emit","err","alertError","message","toggleClass","alertSuccess","scrollTop","count","scrollBottom","topIndex","bottomIndex","after","direction","callback","params","loadMore","query","categoryTopicSort","done"],"mappings":"AAAA,aAEAA,OAAO,kBACN,uBACA,QACA,YACA,uBACA,YACA,QACE,SAAUC,EAAgBC,EAAOC,EAAWC,EAAeC,EAAWC,GACxE,IAAIC,KAEJC,EAAEC,QAAQC,GAAG,uBAAwB,SAAUC,EAAIC,GAClD,IAAKC,OAAOD,EAAKE,KAAKC,WAAW,aAAc,CAC9CZ,EAAUa,UAEVC,OAIF,SAASA,IACRb,EAAca,kBACdZ,EAAUY,kBAGXV,EAASW,KAAO,WACf,IAAIC,EAAMC,QAAQR,KAAKO,IAEvBE,IAAIC,UAAU,YAAcH,GAE5BjB,EAAMqB,iBAAiBH,QAAQR,KAAKY,MAEpCpB,EAAcc,KAAKC,GAEnBd,EAAUa,KAAK,WAAYO,GAE3BnB,EAAKoB,WAAW,oBAAqB,uBAAwB,YAAcN,QAAQR,KAAKe,MAExF,IAAKC,OAAOC,cAAe,CAC1B1B,EAAUe,KAAK,+BAAgCE,QAAQR,KAAKkB,YAAavB,EAASwB,MAAOxB,EAASyB,SAAUzB,EAAS0B,uBAC/G,CACN9B,EAAUa,UAGXkB,IAEAC,EAAkBhB,GAElBX,EAAEC,QAAQ2B,QAAQ,wBAA0BC,OAAQjB,QAAQR,KAAKyB,SACjE7B,EAAEC,QAAQ2B,QAAQ,0BAA4BjB,IAAKC,QAAQR,KAAKO,OAGjE,SAASe,IACR,IAAII,EAAQ7B,OAAO8B,SAASC,SAASC,MAAM,KAC3C,IAAIC,EAAaJ,EAAMA,EAAMK,OAAS,GACtC,GAAID,GAAcE,MAAMC,SAASH,GAAa,CAC7CA,EAAaI,KAAKC,IAAI,EAAGC,SAASN,EAAY,IAAM,GACpD,GAAIA,GAAcjC,OAAO8B,SAASU,OAAOC,QAAQ,YAAc,EAAG,CACjE/C,EAAUgD,gBAAgB3C,EAAE,4CAA8CkC,EAAa,MAAO,KAAM,KAKvG,SAASP,EAAkBhB,GAC1BX,EAAE,wGAAwGE,GAAG,QAAS,WACrH,IAAI0C,EAAQ5C,EAAE6C,MACd,IAAIC,EAAQF,EAAMG,KAAK,cAEvBC,OAAOC,KAAK,4BAA8BtC,IAAKA,EAAKmC,MAAOA,GAAS,SAAUI,GAC7E,GAAIA,EAAK,CACR,OAAOrC,IAAIsC,WAAWD,EAAIE,SAG3BpD,EAAE,wCAAwCqD,YAAY,SAAUP,IAAU,YAC1E9C,EAAE,yCAAyCqD,YAAY,WAAYP,IAAU,YAE7E9C,EAAE,2CAA2CqD,YAAY,SAAUP,IAAU,eAC7E9C,EAAE,4CAA4CqD,YAAY,WAAYP,IAAU,eAEhF9C,EAAE,wCAAwCqD,YAAY,SAAUP,IAAU,YAC1E9C,EAAE,yCAAyCqD,YAAY,WAAYP,IAAU,YAE7EjC,IAAIyC,aAAa,cAAgBR,EAAQ,kBAK5C/C,EAASwB,MAAQ,WAChB5B,EAAU4D,UAAU,IAGrBxD,EAASyB,SAAW,WACnBwB,OAAOC,KAAK,2BAA4BrC,QAAQR,KAAKO,IAAK,SAAUuC,EAAKM,GACxE,GAAIN,EAAK,CACR,OAAOrC,IAAIsC,WAAWD,EAAIE,SAG3BzD,EAAU8D,aAAaD,EAAQ,MAIjCzD,EAAS0B,kBAAoB,SAAUiC,EAAUC,GAChD,OAAOA,GAGR,SAAS1C,EAAgB2C,EAAOC,EAAWC,GAC1CA,EAAWA,GAAY,aAEvB9D,EAAEC,QAAQ2B,QAAQ,2BAClB,IAAImC,EAAS3B,MAAM2B,SACnBtE,EAAeuE,SAAS,uBACvBrD,IAAKC,QAAQR,KAAKO,IAClBiD,MAAOA,EACPC,UAAWA,EACXI,MAAOF,EACPG,kBAAmB9C,OAAO8C,mBACxB,SAAU9D,EAAM+D,GAClBnE,EAAEC,QAAQ2B,QAAQ,0BAClBkC,EAAS1D,EAAM+D,KAIjB,OAAOpE","file":"public/src/client/category.js","sourcesContent":["'use strict';\r\n\r\ndefine('forum/category', [\r\n\t'forum/infinitescroll',\r\n\t'share',\r\n\t'navigator',\r\n\t'forum/category/tools',\r\n\t'topicList',\r\n\t'sort',\r\n], function (infinitescroll, share, navigator, categoryTools, topicList, sort) {\r\n\tvar Category = {};\r\n\r\n\t$(window).on('action:ajaxify.start', function (ev, data) {\r\n\t\tif (!String(data.url).startsWith('category/')) {\r\n\t\t\tnavigator.disable();\r\n\r\n\t\t\tremoveListeners();\r\n\t\t}\r\n\t});\r\n\r\n\tfunction removeListeners() {\r\n\t\tcategoryTools.removeListeners();\r\n\t\ttopicList.removeListeners();\r\n\t}\r\n\r\n\tCategory.init = function () {\r\n\t\tvar\tcid = ajaxify.data.cid;\r\n\r\n\t\tapp.enterRoom('category_' + cid);\r\n\r\n\t\tshare.addShareHandlers(ajaxify.data.name);\r\n\r\n\t\tcategoryTools.init(cid);\r\n\r\n\t\ttopicList.init('category', loadTopicsAfter);\r\n\r\n\t\tsort.handleSort('categoryTopicSort', 'user.setCategorySort', 'category/' + ajaxify.data.slug);\r\n\r\n\t\tif (!config.usePagination) {\r\n\t\t\tnavigator.init('[component=\"category/topic\"]', ajaxify.data.topic_count, Category.toTop, Category.toBottom, Category.navigatorCallback);\r\n\t\t} else {\r\n\t\t\tnavigator.disable();\r\n\t\t}\r\n\r\n\t\thandleScrollToTopicIndex();\r\n\r\n\t\thandleIgnoreWatch(cid);\r\n\r\n\t\t$(window).trigger('action:topics.loaded', { topics: ajaxify.data.topics });\r\n\t\t$(window).trigger('action:category.loaded', { cid: ajaxify.data.cid });\r\n\t};\r\n\r\n\tfunction handleScrollToTopicIndex() {\r\n\t\tvar parts = window.location.pathname.split('/');\r\n\t\tvar topicIndex = parts[parts.length - 1];\r\n\t\tif (topicIndex && utils.isNumber(topicIndex)) {\r\n\t\t\ttopicIndex = Math.max(0, parseInt(topicIndex, 10) - 1);\r\n\t\t\tif (topicIndex && window.location.search.indexOf('page=') === -1) {\r\n\t\t\t\tnavigator.scrollToElement($('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]'), true, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleIgnoreWatch(cid) {\r\n\t\t$('[component=\"category/watching\"], [component=\"category/ignoring\"], [component=\"category/notwatching\"]').on('click', function () {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar state = $this.attr('data-state');\r\n\r\n\t\t\tsocket.emit('categories.setWatchState', { cid: cid, state: state }, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$('[component=\"category/watching/menu\"]').toggleClass('hidden', state !== 'watching');\r\n\t\t\t\t$('[component=\"category/watching/check\"]').toggleClass('fa-check', state === 'watching');\r\n\r\n\t\t\t\t$('[component=\"category/notwatching/menu\"]').toggleClass('hidden', state !== 'notwatching');\r\n\t\t\t\t$('[component=\"category/notwatching/check\"]').toggleClass('fa-check', state === 'notwatching');\r\n\r\n\t\t\t\t$('[component=\"category/ignoring/menu\"]').toggleClass('hidden', state !== 'ignoring');\r\n\t\t\t\t$('[component=\"category/ignoring/check\"]').toggleClass('fa-check', state === 'ignoring');\r\n\r\n\t\t\t\tapp.alertSuccess('[[category:' + state + '.message]]');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tCategory.toTop = function () {\r\n\t\tnavigator.scrollTop(0);\r\n\t};\r\n\r\n\tCategory.toBottom = function () {\r\n\t\tsocket.emit('categories.getTopicCount', ajaxify.data.cid, function (err, count) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tnavigator.scrollBottom(count - 1);\r\n\t\t});\r\n\t};\r\n\r\n\tCategory.navigatorCallback = function (topIndex, bottomIndex) {\r\n\t\treturn bottomIndex;\r\n\t};\r\n\r\n\tfunction loadTopicsAfter(after, direction, callback) {\r\n\t\tcallback = callback || function () {};\r\n\r\n\t\t$(window).trigger('action:category.loading');\r\n\t\tvar params = utils.params();\r\n\t\tinfinitescroll.loadMore('categories.loadMore', {\r\n\t\t\tcid: ajaxify.data.cid,\r\n\t\t\tafter: after,\r\n\t\t\tdirection: direction,\r\n\t\t\tquery: params,\r\n\t\t\tcategoryTopicSort: config.categoryTopicSort,\r\n\t\t}, function (data, done) {\r\n\t\t\t$(window).trigger('action:category.loaded');\r\n\t\t\tcallback(data, done);\r\n\t\t});\r\n\t}\r\n\r\n\treturn Category;\r\n});\r\n"]}