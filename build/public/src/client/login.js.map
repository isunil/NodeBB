{"version":3,"sources":["public/src/client/login.js"],"names":["define","Login","init","errorEl","$","submitEl","formEl","on","e","preventDefault","val","find","translateText","show","hide","hasClass","addClass","app","flags","_sessionRefresh","ajaxSubmit","headers","x-csrf-token","config","csrf_token","success","data","params","utils","url","next","loggedin","updateHeader","ajaxify","go","window","trigger","error","status","responseText","location","href","relative_path","removeClass","length","select","focus"],"mappings":"AAAA,aAGAA,OAAO,iBAAmB,WACzB,IAAIC,KAEJA,EAAMC,KAAO,WACZ,IAAIC,EAAUC,EAAE,uBAChB,IAAIC,EAAWD,EAAE,UACjB,IAAIE,EAASF,EAAE,eAEfC,EAASE,GAAG,QAAS,SAAUC,GAC9BA,EAAEC,iBAEF,IAAKL,EAAE,aAAaM,QAAUN,EAAE,aAAaM,MAAO,CACnDP,EAAQQ,KAAK,KAAKC,cAAc,0CAChCT,EAAQU,WACF,CACNV,EAAQW,OAER,GAAIT,EAASU,SAAS,YAAa,CAClC,OAGDV,EAASW,SAAS,YAMlBC,IAAIC,MAAQD,IAAIC,UAChBD,IAAIC,MAAMC,gBAAkB,KAE5Bb,EAAOc,YACNC,SACCC,eAAgBC,OAAOC,YAExBC,QAAS,SAAUC,GAClB,IAAIC,EAASC,MAAMD,QAASE,IAAKH,EAAKI,OACtCH,EAAOI,SAAW,KAElBd,IAAIe,aAAaN,EAAM,WACtBO,QAAQC,GAAGR,EAAKI,MAChBb,IAAIC,MAAMC,gBAAkB,MAC5Bf,EAAE+B,QAAQC,QAAQ,sBAAuBV,MAG3CW,MAAO,SAAUX,GAChB,GAAIA,EAAKY,SAAW,KAAOZ,EAAKa,eAAiB,YAAa,CAC7DJ,OAAOK,SAASC,KAAOlB,OAAOmB,cAAgB,gCACxC,CACNvC,EAAQQ,KAAK,KAAKC,cAAcc,EAAKa,cACrCpC,EAAQU,OACRR,EAASsC,YAAY,YACrB1B,IAAIC,MAAMC,gBAAkB,MAG5B,GAAIf,EAAE,mBAAmBwC,OAAQ,CAChCxC,EAAE,aAAayC,iBAQrBzC,EAAE,8BAA8BG,GAAG,QAAS,SAAUC,GACrDA,EAAEC,iBACFN,EAAQW,OACR,OAAO,QAGR,GAAIV,EAAE,sBAAsBM,MAAO,CAClCN,EAAE,sBAAsBM,IAAI,IAAIoC,YAC1B,CACN1C,EAAE,sBAAsB0C,QAEzB1C,EAAE,sBAAsBM,IAAI,UAG7B,OAAOT","file":"public/src/client/login.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/login', [], function () {\r\n\tvar\tLogin = {};\r\n\r\n\tLogin.init = function () {\r\n\t\tvar errorEl = $('#login-error-notify');\r\n\t\tvar submitEl = $('#login');\r\n\t\tvar formEl = $('#login-form');\r\n\r\n\t\tsubmitEl.on('click', function (e) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif (!$('#username').val() || !$('#password').val()) {\r\n\t\t\t\terrorEl.find('p').translateText('[[error:invalid-username-or-password]]');\r\n\t\t\t\terrorEl.show();\r\n\t\t\t} else {\r\n\t\t\t\terrorEl.hide();\r\n\r\n\t\t\t\tif (submitEl.hasClass('disabled')) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsubmitEl.addClass('disabled');\r\n\r\n\t\t\t\t/*\r\n\t\t\t\t\tSet session refresh flag (otherwise the session check will trip and throw invalid session modal)\r\n\t\t\t\t\tWe know the session is/will be invalid (uid mismatch) because the user is attempting a login\r\n\t\t\t\t*/\r\n\t\t\t\tapp.flags = app.flags || {};\r\n\t\t\t\tapp.flags._sessionRefresh = true;\r\n\r\n\t\t\t\tformEl.ajaxSubmit({\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'x-csrf-token': config.csrf_token,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function (data) {\r\n\t\t\t\t\t\tvar params = utils.params({ url: data.next });\r\n\t\t\t\t\t\tparams.loggedin = true;\r\n\r\n\t\t\t\t\t\tapp.updateHeader(data, function () {\r\n\t\t\t\t\t\t\tajaxify.go(data.next);\r\n\t\t\t\t\t\t\tapp.flags._sessionRefresh = false;\r\n\t\t\t\t\t\t\t$(window).trigger('action:app.loggedIn', data);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function (data) {\r\n\t\t\t\t\t\tif (data.status === 403 && data.responseText === 'Forbidden') {\r\n\t\t\t\t\t\t\twindow.location.href = config.relative_path + '/login?error=csrf-invalid';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\terrorEl.find('p').translateText(data.responseText);\r\n\t\t\t\t\t\t\terrorEl.show();\r\n\t\t\t\t\t\t\tsubmitEl.removeClass('disabled');\r\n\t\t\t\t\t\t\tapp.flags._sessionRefresh = false;\r\n\r\n\t\t\t\t\t\t\t// Select the entire password if that field has focus\r\n\t\t\t\t\t\t\tif ($('#password:focus').length) {\r\n\t\t\t\t\t\t\t\t$('#password').select();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#login-error-notify button').on('click', function (e) {\r\n\t\t\te.preventDefault();\r\n\t\t\terrorEl.hide();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tif ($('#content #username').val()) {\r\n\t\t\t$('#content #password').val('').focus();\r\n\t\t} else {\r\n\t\t\t$('#content #username').focus();\r\n\t\t}\r\n\t\t$('#content #noscript').val('false');\r\n\t};\r\n\r\n\treturn Login;\r\n});\r\n"]}