{"version":3,"sources":["public/src/admin/manage/groups.js"],"names":["define","translator","Benchpress","Groups","intervalId","init","createModal","$","createGroupName","createModalGo","createModalError","handleSearch","on","e","keyCode","click","modal","setTimeout","focus","submitObj","name","val","description","private","is","hidden","socket","emit","err","groupData","hasOwnProperty","utils","hasLanguageKey","message","translateHtml","removeClass","addClass","ajaxify","go","el","this","action","attr","groupName","parents","bootbox","confirm","app","alertError","refresh","queryEl","doSearch","groupsEl","query","options","sort","groups","parse","html","translate","find","remove","append","clearTimeout"],"mappings":"AAAA,aAGAA,OAAO,uBAAwB,aAAc,cAAe,SAAUC,EAAYC,GACjF,IAAIC,KAEJ,IAAIC,EAAa,EAEjBD,EAAOE,KAAO,WACb,IAAIC,EAAcC,EAAE,iBACpB,IAAIC,EAAkBD,EAAE,sBACxB,IAAIE,EAAgBF,EAAE,oBACtB,IAAIG,EAAmBH,EAAE,uBAEzBI,IAEAL,EAAYM,GAAG,WAAY,SAAUC,GACpC,GAAIA,EAAEC,UAAY,GAAI,CACrBL,EAAcM,WAIhBR,EAAE,WAAWK,GAAG,QAAS,WACxBN,EAAYU,MAAM,QAClBC,WAAW,WACVT,EAAgBU,SACd,OAGJT,EAAcG,GAAG,QAAS,WACzB,IAAIO,GACHC,KAAMZ,EAAgBa,MACtBC,YAAaf,EAAE,sBAAsBc,MACrCE,QAAShB,EAAE,yBAAyBiB,GAAG,YAAc,EAAI,EACzDC,OAAQlB,EAAE,wBAAwBiB,GAAG,YAAc,EAAI,GAGxDE,OAAOC,KAAK,sBAAuBR,EAAW,SAAUS,EAAKC,GAC5D,GAAID,EAAK,CACR,GAAIA,EAAIE,eAAe,YAAcC,MAAMC,eAAeJ,EAAIK,SAAU,CACvEL,EAAM,gDAEPlB,EAAiBwB,cAAcN,GAAKO,YAAY,YAC1C,CACNzB,EAAiB0B,SAAS,QAC1B5B,EAAgBa,IAAI,IACpBf,EAAYM,GAAG,kBAAmB,WACjCyB,QAAQC,GAAG,uBAAyBT,EAAUT,QAE/Cd,EAAYU,MAAM,aAKrBT,EAAE,gBAAgBK,GAAG,QAAS,sBAAuB,WACpD,IAAI2B,EAAKhC,EAAEiC,MACX,IAAIC,EAASF,EAAGG,KAAK,eACrB,IAAIC,EAAYJ,EAAGK,QAAQ,sBAAsBF,KAAK,kBAEtD,OAAQD,GACR,IAAK,SACJI,QAAQC,QAAQ,gDAAiD,SAAUA,GAC1E,GAAIA,EAAS,CACZpB,OAAOC,KAAK,iBACXgB,UAAWA,GACT,SAAUf,GACZ,GAAIA,EAAK,CACR,OAAOmB,IAAIC,WAAWpB,EAAIK,SAG3BI,QAAQY,eAIX,UAKH,SAAStC,IACR,IAAIuC,EAAU3C,EAAE,iBAEhB,SAAS4C,IACR,IAAKD,EAAQ7B,MAAO,CACnB,OAAOgB,QAAQY,UAEhB1C,EAAE,eAAe6B,SAAS,QAC1B,IAAIgB,EAAW7C,EAAE,gBACjBmB,OAAOC,KAAK,iBACX0B,MAAOH,EAAQ7B,MACfiC,SACCC,KAAM,SAEL,SAAU3B,EAAK4B,GACjB,GAAI5B,EAAK,CACR,OAAOmB,IAAIC,WAAWpB,EAAIK,SAG3B/B,EAAWuD,MAAM,sBAAuB,UACvCD,OAAQA,GACN,SAAUE,GACZzD,EAAW0D,UAAUD,EAAM,SAAUA,GACpCN,EAASQ,KAAK,oBAAoBC,SAClCT,EAASQ,KAAK,SAASE,OAAOJ,SAMlCR,EAAQtC,GAAG,QAAS,WACnB,GAAIR,EAAY,CACf2D,aAAa3D,GACbA,EAAa,EAEdA,EAAaa,WAAWkC,EAAU,OAKpC,OAAOhD","file":"public/src/admin/manage/groups.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/manage/groups', ['translator', 'benchpress'], function (translator, Benchpress) {\r\n\tvar\tGroups = {};\r\n\r\n\tvar intervalId = 0;\r\n\r\n\tGroups.init = function () {\r\n\t\tvar\tcreateModal = $('#create-modal');\r\n\t\tvar createGroupName = $('#create-group-name');\r\n\t\tvar createModalGo = $('#create-modal-go');\r\n\t\tvar createModalError = $('#create-modal-error');\r\n\r\n\t\thandleSearch();\r\n\r\n\t\tcreateModal.on('keypress', function (e) {\r\n\t\t\tif (e.keyCode === 13) {\r\n\t\t\t\tcreateModalGo.click();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#create').on('click', function () {\r\n\t\t\tcreateModal.modal('show');\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tcreateGroupName.focus();\r\n\t\t\t}, 250);\r\n\t\t});\r\n\r\n\t\tcreateModalGo.on('click', function () {\r\n\t\t\tvar submitObj = {\r\n\t\t\t\tname: createGroupName.val(),\r\n\t\t\t\tdescription: $('#create-group-desc').val(),\r\n\t\t\t\tprivate: $('#create-group-private').is(':checked') ? 1 : 0,\r\n\t\t\t\thidden: $('#create-group-hidden').is(':checked') ? 1 : 0,\r\n\t\t\t};\r\n\r\n\t\t\tsocket.emit('admin.groups.create', submitObj, function (err, groupData) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tif (err.hasOwnProperty('message') && utils.hasLanguageKey(err.message)) {\r\n\t\t\t\t\t\terr = '[[admin/manage/groups:alerts.create-failure]]';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcreateModalError.translateHtml(err).removeClass('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcreateModalError.addClass('hide');\r\n\t\t\t\t\tcreateGroupName.val('');\r\n\t\t\t\t\tcreateModal.on('hidden.bs.modal', function () {\r\n\t\t\t\t\t\tajaxify.go('admin/manage/groups/' + groupData.name);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcreateModal.modal('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.groups-list').on('click', 'button[data-action]', function () {\r\n\t\t\tvar el = $(this);\r\n\t\t\tvar action = el.attr('data-action');\r\n\t\t\tvar groupName = el.parents('tr[data-groupname]').attr('data-groupname');\r\n\r\n\t\t\tswitch (action) {\r\n\t\t\tcase 'delete':\r\n\t\t\t\tbootbox.confirm('[[admin/manage/groups:alerts.confirm-delete]]', function (confirm) {\r\n\t\t\t\t\tif (confirm) {\r\n\t\t\t\t\t\tsocket.emit('groups.delete', {\r\n\t\t\t\t\t\t\tgroupName: groupName,\r\n\t\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tfunction handleSearch() {\r\n\t\tvar queryEl = $('#group-search');\r\n\r\n\t\tfunction doSearch() {\r\n\t\t\tif (!queryEl.val()) {\r\n\t\t\t\treturn ajaxify.refresh();\r\n\t\t\t}\r\n\t\t\t$('.pagination').addClass('hide');\r\n\t\t\tvar groupsEl = $('.groups-list');\r\n\t\t\tsocket.emit('groups.search', {\r\n\t\t\t\tquery: queryEl.val(),\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tsort: 'date',\r\n\t\t\t\t},\r\n\t\t\t}, function (err, groups) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tBenchpress.parse('admin/manage/groups', 'groups', {\r\n\t\t\t\t\tgroups: groups,\r\n\t\t\t\t}, function (html) {\r\n\t\t\t\t\ttranslator.translate(html, function (html) {\r\n\t\t\t\t\t\tgroupsEl.find('[data-groupname]').remove();\r\n\t\t\t\t\t\tgroupsEl.find('tbody').append(html);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tqueryEl.on('keyup', function () {\r\n\t\t\tif (intervalId) {\r\n\t\t\t\tclearTimeout(intervalId);\r\n\t\t\t\tintervalId = 0;\r\n\t\t\t}\r\n\t\t\tintervalId = setTimeout(doSearch, 200);\r\n\t\t});\r\n\t}\r\n\r\n\r\n\treturn Groups;\r\n});\r\n"]}