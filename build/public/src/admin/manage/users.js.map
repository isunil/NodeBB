{"version":3,"sources":["public/src/admin/manage/users.js"],"names":["define","translator","Benchpress","autocomplete","Users","init","navPills","$","pathname","window","location","find","length","config","relative_path","removeClass","parent","addClass","val","ajaxify","data","resultsPerPage","on","query","utils","params","go","param","getSelectedUids","uids","each","this","is","push","attr","update","className","state","parents","toggleClass","unselectAll","prop","removeSelected","remove","done","successMessage","flag","err","app","alertError","message","alertSuccess","socket","emit","parse","html","modal","bootbox","dialog","escapeHTML","title","onEscape","group","ev","ui","uid","target","groupName","item","value","nameEscaped","escape","displayName","parseAndTranslate","users","groups","append","groupCard","confirm","reason","show","buttons","close","label","submit","callback","formData","serializeArray","reduce","cur","name","until","Date","now","parseInt","unit","refresh","handleUserCreate","cancel","create","createUser","call","username","document","getElementById","email","password","passwordAgain","errorEl","translateHtml","user","timeoutId","clearTimeout","$this","type","setTimeout","searchBy","translate","timeago","compile","timing","handleInvite","prompt"],"mappings":"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","file":"public/src/admin/manage/users.js","sourcesContent":["'use strict';\r\n\r\ndefine('admin/manage/users', ['translator', 'benchpress', 'autocomplete'], function (translator, Benchpress, autocomplete) {\r\n\tvar Users = {};\r\n\r\n\tUsers.init = function () {\r\n\t\tvar navPills = $('.nav-pills li');\r\n\t\tvar pathname = window.location.pathname;\r\n\t\tif (!navPills.find('a[href^=\"' + pathname + '\"]').length || pathname === config.relative_path + '/admin/manage/users') {\r\n\t\t\tpathname = config.relative_path + '/admin/manage/users/latest';\r\n\t\t}\r\n\t\tnavPills.removeClass('active').find('a[href^=\"' + pathname + '\"]').parent().addClass('active');\r\n\r\n\t\t$('#results-per-page').val(ajaxify.data.resultsPerPage).on('change', function () {\r\n\t\t\tvar query = utils.params();\r\n\t\t\tquery.resultsPerPage = $('#results-per-page').val();\r\n\t\t\tajaxify.go(window.location.pathname + '?' + $.param(query));\r\n\t\t});\r\n\r\n\t\tfunction getSelectedUids() {\r\n\t\t\tvar uids = [];\r\n\r\n\t\t\t$('.users-table [component=\"user/select/single\"]').each(function () {\r\n\t\t\t\tif ($(this).is(':checked')) {\r\n\t\t\t\t\tuids.push($(this).attr('data-uid'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn uids;\r\n\t\t}\r\n\r\n\t\tfunction update(className, state) {\r\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').find(className).each(function () {\r\n\t\t\t\t$(this).toggleClass('hidden', !state);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction unselectAll() {\r\n\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', false);\r\n\t\t\t$('.users-table [component=\"user/select/all\"]').prop('checked', false);\r\n\t\t}\r\n\r\n\t\tfunction removeSelected() {\r\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').remove();\r\n\t\t}\r\n\r\n\t\tfunction done(successMessage, className, flag) {\r\n\t\t\treturn function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tapp.alertSuccess(successMessage);\r\n\t\t\t\tif (className) {\r\n\t\t\t\t\tupdate(className, flag);\r\n\t\t\t\t}\r\n\t\t\t\tunselectAll();\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t$('[component=\"user/select/all\"]').on('click', function () {\r\n\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', $(this).is(':checked'));\r\n\t\t});\r\n\r\n\t\t$('.manage-groups').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tsocket.emit('admin.user.loadGroups', uids, function (err, data) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t}\r\n\t\t\t\tBenchpress.parse('admin/partials/manage_user_groups', data, function (html) {\r\n\t\t\t\t\tvar modal = bootbox.dialog({\r\n\t\t\t\t\t\tmessage: utils.escapeHTML(html),\r\n\t\t\t\t\t\ttitle: '[[admin/manage/users:manage-groups]]',\r\n\t\t\t\t\t\tonEscape: true,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tmodal.on('shown.bs.modal', function () {\r\n\t\t\t\t\t\tautocomplete.group(modal.find('.group-search'), function (ev, ui) {\r\n\t\t\t\t\t\t\tvar uid = $(ev.target).attr('data-uid');\r\n\t\t\t\t\t\t\tsocket.emit('admin.groups.join', { uid: uid, groupName: ui.item.value }, function (err) {\r\n\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tui.item.group.nameEscaped = translator.escape(ui.item.group.displayName);\r\n\t\t\t\t\t\t\t\tapp.parseAndTranslate('admin/partials/manage_user_groups', { users: [{ groups: [ui.item.group] }] }, function (html) {\r\n\t\t\t\t\t\t\t\t\t$('[data-uid=' + uid + '] .group-area').append(html.find('.group-area').html());\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tmodal.on('click', '.group-area a', function () {\r\n\t\t\t\t\t\tmodal.modal('hide');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tmodal.on('click', '.remove-group-icon', function () {\r\n\t\t\t\t\t\tvar groupCard = $(this).parents('[data-group-name]');\r\n\t\t\t\t\t\tvar groupName = groupCard.attr('data-group-name');\r\n\t\t\t\t\t\tvar uid = $(this).parents('[data-uid]').attr('data-uid');\r\n\t\t\t\t\t\tsocket.emit('admin.groups.leave', { uid: uid, groupName: groupName }, function (err) {\r\n\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tgroupCard.remove();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.ban-user').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\r\n\t\t\t\treturn false;\t// specifically to keep the menu open\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm((uids.length > 1 ? '[[admin/manage/users:alerts.confirm-ban-multi]]' : '[[admin/manage/users:alerts.confirm-ban]]'), function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('user.banUsers', { uids: uids, reason: '' }, done('[[admin/manage/users:alerts.ban-success]]', '.ban', true));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.ban-user-temporary').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\r\n\t\t\t\treturn false;\t// specifically to keep the menu open\r\n\t\t\t}\r\n\r\n\t\t\tBenchpress.parse('admin/partials/temporary-ban', {}, function (html) {\r\n\t\t\t\tbootbox.dialog({\r\n\t\t\t\t\tclassName: 'ban-modal',\r\n\t\t\t\t\ttitle: '[[user:ban_account]]',\r\n\t\t\t\t\tmessage: html,\r\n\t\t\t\t\tshow: true,\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tclose: {\r\n\t\t\t\t\t\t\tlabel: '[[global:close]]',\r\n\t\t\t\t\t\t\tclassName: 'btn-link',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsubmit: {\r\n\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-ban-x, ' + uids.length + ']]',\r\n\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\tvar formData = $('.ban-modal form').serializeArray().reduce(function (data, cur) {\r\n\t\t\t\t\t\t\t\t\tdata[cur.name] = cur.value;\r\n\t\t\t\t\t\t\t\t\treturn data;\r\n\t\t\t\t\t\t\t\t}, {});\r\n\t\t\t\t\t\t\t\tvar until = formData.length > 0 ? (Date.now() + (formData.length * 1000 * 60 * 60 * (parseInt(formData.unit, 10) ? 24 : 1))) : 0;\r\n\t\t\t\t\t\t\t\tsocket.emit('user.banUsers', { uids: uids, until: until, reason: formData.reason }, done('[[admin/manage/users:alerts.ban-success]]', '.ban', true));\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.unban-user').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\r\n\t\t\t\treturn false;\t// specifically to keep the menu open\r\n\t\t\t}\r\n\r\n\t\t\tsocket.emit('user.unbanUsers', uids, done('[[admin/manage/users:alerts.unban-success]]', '.ban', false));\r\n\t\t});\r\n\r\n\t\t$('.reset-lockout').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsocket.emit('admin.user.resetLockouts', uids, done('[[admin/manage/users:alerts.lockout-reset-success]]'));\r\n\t\t});\r\n\r\n\t\t$('.validate-email').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-validate-email]]', function (confirm) {\r\n\t\t\t\tif (!confirm) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tsocket.emit('admin.user.validateEmail', uids, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.validate-email-success]]');\r\n\t\t\t\t\tupdate('.notvalidated', false);\r\n\t\t\t\t\tupdate('.validated', true);\r\n\t\t\t\t\tunselectAll();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.send-validation-email').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsocket.emit('admin.user.sendValidationEmail', uids, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tapp.alertSuccess('[[notifications:email-confirm-sent]]');\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.password-reset-email').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.password-reset-confirm]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.user.sendPasswordResetEmail', uids, done('[[notifications:email-confirm-sent]]'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.force-password-reset').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-force-password-reset]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.user.forcePasswordReset', uids, done('[[admin/manage/users:alerts.validate-force-password-reset-success]]'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.delete-user').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-delete]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.user.deleteUsers', uids, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\r\n\t\t\t\t\t\tremoveSelected();\r\n\t\t\t\t\t\tunselectAll();\r\n\t\t\t\t\t\tif (!$('.users-table [component=\"user/select/single\"]').length) {\r\n\t\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.delete-user-and-content').on('click', function () {\r\n\t\t\tvar uids = getSelectedUids();\r\n\t\t\tif (!uids.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-purge]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.user.deleteUsersAndContent', uids, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\r\n\t\t\t\t\t\tremoveSelected();\r\n\t\t\t\t\t\tunselectAll();\r\n\t\t\t\t\t\tif (!$('.users-table [component=\"user/select/single\"]').length) {\r\n\t\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tfunction handleUserCreate() {\r\n\t\t\t$('#createUser').on('click', function () {\r\n\t\t\t\tBenchpress.parse('admin/partials/create_user_modal', {}, function (html) {\r\n\t\t\t\t\tbootbox.dialog({\r\n\t\t\t\t\t\tmessage: html,\r\n\t\t\t\t\t\ttitle: '[[admin/manage/users:alerts.create]]',\r\n\t\t\t\t\t\tonEscape: true,\r\n\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\tcancel: {\r\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-cancel]]',\r\n\t\t\t\t\t\t\t\tclassName: 'btn-link',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcreate: {\r\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-create]]',\r\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\r\n\t\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\t\tcreateUser.call(this);\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction createUser() {\r\n\t\t\tvar modal = this;\r\n\t\t\tvar username = document.getElementById('create-user-name').value;\r\n\t\t\tvar email = document.getElementById('create-user-email').value;\r\n\t\t\tvar password = document.getElementById('create-user-password').value;\r\n\t\t\tvar passwordAgain = document.getElementById('create-user-password-again').value;\r\n\r\n\t\t\tvar errorEl = $('#create-modal-error');\r\n\r\n\t\t\tif (password !== passwordAgain) {\r\n\t\t\t\treturn errorEl.translateHtml('[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]').removeClass('hide');\r\n\t\t\t}\r\n\r\n\t\t\tvar user = {\r\n\t\t\t\tusername: username,\r\n\t\t\t\temail: email,\r\n\t\t\t\tpassword: password,\r\n\t\t\t};\r\n\r\n\t\t\tsocket.emit('admin.user.createUser', user, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn errorEl.translateHtml('[[admin/manage/users:alerts.error-x, ' + err.message + ']]').removeClass('hide');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmodal.modal('hide');\r\n\t\t\t\tmodal.on('hidden.bs.modal', function () {\r\n\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t});\r\n\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.create-success]]');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar timeoutId = 0;\r\n\r\n\t\t$('#search-user-uid, #search-user-name, #search-user-email, #search-user-ip').on('keyup', function () {\r\n\t\t\tif (timeoutId !== 0) {\r\n\t\t\t\tclearTimeout(timeoutId);\r\n\t\t\t\ttimeoutId = 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar type = $this.attr('data-search-type');\r\n\r\n\t\t\ttimeoutId = setTimeout(function () {\r\n\t\t\t\t$('.fa-spinner').removeClass('hidden');\r\n\r\n\t\t\t\tsocket.emit('admin.user.search', { searchBy: type, query: $this.val() }, function (err, data) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tBenchpress.parse('admin/manage/users', 'users', data, function (html) {\r\n\t\t\t\t\t\ttranslator.translate(html, function (html) {\r\n\t\t\t\t\t\t\thtml = $(html);\r\n\t\t\t\t\t\t\t$('.users-table tbody tr').remove();\r\n\t\t\t\t\t\t\t$('.users-table tbody').append(html);\r\n\t\t\t\t\t\t\thtml.find('.timeago').timeago();\r\n\t\t\t\t\t\t\t$('.fa-spinner').addClass('hidden');\r\n\r\n\t\t\t\t\t\t\tif (data && data.users.length === 0) {\r\n\t\t\t\t\t\t\t\t$('#user-notfound-notify').translateHtml('[[admin/manage/users:search.not-found]]')\r\n\t\t\t\t\t\t\t\t\t.removeClass('hide')\r\n\t\t\t\t\t\t\t\t\t.addClass('label-danger')\r\n\t\t\t\t\t\t\t\t\t.removeClass('label-success');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$('#user-notfound-notify').translateHtml(translator.compile('admin/manage/users:alerts.x-users-found', data.users.length, data.timing))\r\n\t\t\t\t\t\t\t\t\t.removeClass('hide')\r\n\t\t\t\t\t\t\t\t\t.addClass('label-success')\r\n\t\t\t\t\t\t\t\t\t.removeClass('label-danger');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}, 250);\r\n\t\t});\r\n\r\n\t\thandleUserCreate();\r\n\r\n\t\thandleInvite();\r\n\t};\r\n\r\n\tfunction handleInvite() {\r\n\t\t$('[component=\"user/invite\"]').on('click', function () {\r\n\t\t\tbootbox.prompt('[[admin/manage/users:alerts.prompt-email]]', function (email) {\r\n\t\t\t\tif (!email) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsocket.emit('user.invite', email, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.email-sent-to, ' + email + ']]');\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\r\n\treturn Users;\r\n});\r\n"]}