{"version":3,"sources":["public/src/admin/manage/group.js"],"names":["define","memberList","iconSelect","colorpicker","Groups","init","groupIcon","$","changeGroupUserTitle","changeGroupLabelColor","changeGroupTextColor","groupLabelPreview","groupLabelPreviewText","groupName","ajaxify","data","group","name","on","go","this","val","window","location","hash","keyup","text","css","btnEl","userRow","parents","ownerFlagEl","find","isOwner","hasClass","uid","attr","action","socket","emit","toUid","err","app","alertError","message","toggleClass","bootbox","confirm","slideUp","remove","newIcon","enable","hsb","hex","values","userTitle","description","icon","labelColor","textColor","userTitleEnabled","is","private","hidden","disableJoinRequests","disableLeave","newName","encodeURIComponent","undefined","alertSuccess"],"mappings":"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","file":"public/src/admin/manage/group.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/manage/group', [\r\n\t'forum/groups/memberlist',\r\n\t'iconSelect',\r\n\t'admin/modules/colorpicker',\r\n], function (memberList, iconSelect, colorpicker) {\r\n\tvar Groups = {};\r\n\r\n\tGroups.init = function () {\r\n\t\tvar groupIcon = $('#group-icon');\r\n\t\tvar changeGroupUserTitle = $('#change-group-user-title');\r\n\t\tvar changeGroupLabelColor = $('#change-group-label-color');\r\n\t\tvar changeGroupTextColor = $('#change-group-text-color');\r\n\t\tvar groupLabelPreview = $('#group-label-preview');\r\n\t\tvar groupLabelPreviewText = $('#group-label-preview-text');\r\n\r\n\t\tvar groupName = ajaxify.data.group.name;\r\n\r\n\t\t$('#group-selector').on('change', function () {\r\n\t\t\tajaxify.go('admin/manage/groups/' + $(this).val() + window.location.hash);\r\n\t\t});\r\n\r\n\t\tmemberList.init('admin/manage/group');\r\n\r\n\t\tchangeGroupUserTitle.keyup(function () {\r\n\t\t\tgroupLabelPreviewText.text(changeGroupUserTitle.val());\r\n\t\t});\r\n\r\n\t\tchangeGroupLabelColor.keyup(function () {\r\n\t\t\tgroupLabelPreview.css('background', changeGroupLabelColor.val() || '#000000');\r\n\t\t});\r\n\r\n\t\tchangeGroupTextColor.keyup(function () {\r\n\t\t\tgroupLabelPreview.css('color', changeGroupTextColor.val() || '#ffffff');\r\n\t\t});\r\n\r\n\t\t$('[component=\"groups/members\"]').on('click', '[data-action]', function () {\r\n\t\t\tvar btnEl = $(this);\r\n\t\t\tvar userRow = btnEl.parents('[data-uid]');\r\n\t\t\tvar ownerFlagEl = userRow.find('.member-name .user-owner-icon');\r\n\t\t\tvar isOwner = !ownerFlagEl.hasClass('invisible');\r\n\t\t\tvar uid = userRow.attr('data-uid');\r\n\t\t\tvar action = btnEl.attr('data-action');\r\n\r\n\t\t\tswitch (action) {\r\n\t\t\tcase 'toggleOwnership':\r\n\t\t\t\tsocket.emit('groups.' + (isOwner ? 'rescind' : 'grant'), {\r\n\t\t\t\t\ttoUid: uid,\r\n\t\t\t\t\tgroupName: groupName,\r\n\t\t\t\t}, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\townerFlagEl.toggleClass('invisible');\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'kick':\r\n\t\t\t\tbootbox.confirm('[[admin/manage/groups:edit.confirm-remove-user]]', function (confirm) {\r\n\t\t\t\t\tif (!confirm) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsocket.emit('admin.groups.leave', {\r\n\t\t\t\t\t\tuid: uid,\r\n\t\t\t\t\t\tgroupName: groupName,\r\n\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuserRow.slideUp().remove();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#group-icon, #group-icon-label').on('click', function () {\r\n\t\t\ticonSelect.init(groupIcon, function () {\r\n\t\t\t\tvar newIcon = groupIcon.attr('value');\r\n\t\t\t\tif (newIcon === 'fa-nbb-none') {\r\n\t\t\t\t\tnewIcon = 'hidden';\r\n\t\t\t\t}\r\n\t\t\t\t$('#group-icon-preview').attr('class', 'fa fa-fw ' + (newIcon || 'hidden'));\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tcolorpicker.enable(changeGroupLabelColor, function (hsb, hex) {\r\n\t\t\tgroupLabelPreview.css('background-color', '#' + hex);\r\n\t\t});\r\n\r\n\t\tcolorpicker.enable(changeGroupTextColor, function (hsb, hex) {\r\n\t\t\tgroupLabelPreview.css('color', '#' + hex);\r\n\t\t});\r\n\r\n\t\t$('#save').on('click', function () {\r\n\t\t\tsocket.emit('admin.groups.update', {\r\n\t\t\t\tgroupName: groupName,\r\n\t\t\t\tvalues: {\r\n\t\t\t\t\tname: $('#change-group-name').val(),\r\n\t\t\t\t\tuserTitle: changeGroupUserTitle.val(),\r\n\t\t\t\t\tdescription: $('#change-group-desc').val(),\r\n\t\t\t\t\ticon: groupIcon.attr('value'),\r\n\t\t\t\t\tlabelColor: changeGroupLabelColor.val(),\r\n\t\t\t\t\ttextColor: changeGroupTextColor.val(),\r\n\t\t\t\t\tuserTitleEnabled: $('#group-userTitleEnabled').is(':checked'),\r\n\t\t\t\t\tprivate: $('#group-private').is(':checked'),\r\n\t\t\t\t\thidden: $('#group-hidden').is(':checked'),\r\n\t\t\t\t\tdisableJoinRequests: $('#group-disableJoinRequests').is(':checked'),\r\n\t\t\t\t\tdisableLeave: $('#group-disableLeave').is(':checked'),\r\n\t\t\t\t},\r\n\t\t\t}, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar newName = $('#change-group-name').val();\r\n\r\n\t\t\t\t// If the group name changed, change url\r\n\t\t\t\tif (groupName !== newName) {\r\n\t\t\t\t\tajaxify.go('admin/manage/groups/' + encodeURIComponent(newName), undefined, true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.alertSuccess('[[admin/manage/groups:edit.save-success]]');\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\t};\r\n\r\n\treturn Groups;\r\n});\r\n"]}