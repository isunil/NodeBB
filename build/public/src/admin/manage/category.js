"use strict";define("admin/manage/category",["uploader","iconSelect","admin/modules/colorpicker","categorySelector","benchpress"],function(a,e,t,i,n){var r={};var o={};r.init=function(){$("#category-settings select").each(function(){var a=$(this);a.val(a.attr("data-value"))});$("#category-selector").on("change",function(){ajaxify.go("admin/manage/categories/"+$(this).val()+window.location.hash)});function d(a,e){var i=$(e);var n=i.parents("[data-cid]").find(".category-preview");t.enable(i,function(a,e){if(i.attr("data-name")==="bgColor"){n.css("background-color","#"+e)}else if(i.attr("data-name")==="color"){n.css("color","#"+e)}c(i[0])})}s();$("#category-settings input, #category-settings select").on("change",function(a){c(a.target)});$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())});$('[data-name="bgColor"], [data-name="color"]').each(d);$("#save").on("click",function(){if(Object.keys(o).length){socket.emit("admin.categories.update",o,function(a,e){if(a){return app.alertError(a.message)}if(e&&e.length){app.flags._unsaved=false;app.alert({title:"Updated Categories",message:"Category IDs "+e.join(", ")+" was successfully updated.",type:"success",timeout:2e3})}});o={}}return false});$(".purge").on("click",function(a){a.preventDefault();n.parse("admin/partials/categories/purge",{name:ajaxify.data.category.name,topic_count:ajaxify.data.category.topic_count},function(a){var e=bootbox.dialog({title:"[[admin/manage/categories:purge]]",message:a,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){e.find(".modal-footer button").prop("disabled",true);var a=setInterval(function(){socket.emit("categories.getTopicCount",ajaxify.data.category.cid,function(a,t){if(a){return app.alertError(a)}var i=0;if(ajaxify.data.category.topic_count>0){i=Math.max(0,1-t/ajaxify.data.category.topic_count)*100}e.find(".progress-bar").css({width:i+"%"})})},1e3);socket.emit("admin.categories.purge",ajaxify.data.category.cid,function(t){if(t){return app.alertError(t.message)}if(a){clearInterval(a)}e.modal("hide");app.alertSuccess("[[admin/manage/categories:alert.purge-success]]");ajaxify.go("admin/manage/categories")});return false}}}})})});$(".copy-settings").on("click",function(){n.parse("admin/partials/categories/copy-settings",{categories:ajaxify.data.allCategories},function(a){var e;var t=bootbox.dialog({title:"[[modules:composer.select_category]]",message:a,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){if(!e){return}socket.emit("admin.categories.copySettingsFrom",{fromCid:e,toCid:ajaxify.data.category.cid,copyParent:t.find("#copyParent").prop("checked")},function(a){if(a){return app.alertError(a.message)}t.modal("hide");app.alertSuccess("[[admin/manage/categories:alert.copy-success]]");ajaxify.refresh()});return false}}}});t.find(".modal-footer button").prop("disabled",true);i.init(t.find('[component="category-selector"]'),function(a){e=a&&a.cid;if(e){t.find(".modal-footer button").prop("disabled",false)}})});return false});$(".upload-button").on("click",function(){var e=$(this);var t=e.attr("data-cid");a.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:t}},function(a){$("#category-image").val(a);var t=e.parent().parent().siblings(".category-preview");t.css("background","url("+a+"?"+(new Date).getTime()+")");c($("#category-image"))})});$("#category-image").on("change",function(){$(".category-preview").css("background-image",$(this).val()?'url("'+$(this).val()+'")':"");c($("#category-image"))});$(".delete-image").on("click",function(a){a.preventDefault();var e=$("#category-image");var t=$(".category-preview");e.val("");t.css("background-image","");c(e[0]);$(this).parent().addClass("hide").hide()});$(".category-preview").on("click",function(){e.init($(this).find("i"),c)});$('[type="checkbox"]').on("change",function(){c($(this))});$('button[data-action="setParent"], button[data-action="changeParent"]').on("click",r.launchParentSelector);$('button[data-action="removeParent"]').on("click",function(){var a={};a[ajaxify.data.category.cid]={parentCid:0};socket.emit("admin.categories.update",a,function(a){if(a){return app.alertError(a.message)}$('button[data-action="removeParent"]').parent().addClass("hide");$('button[data-action="changeParent"]').parent().addClass("hide");$('button[data-action="setParent"]').removeClass("hide")})});$('button[data-action="toggle"]').on("click",function(){var a={};var e=$(this);var t=e.attr("data-disabled")==="1";a[ajaxify.data.category.cid]={disabled:t?0:1};socket.emit("admin.categories.update",a,function(a){if(a){return app.alertError(a.message)}e.translateText(!t?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]");e.toggleClass("btn-primary",!t).toggleClass("btn-danger",t);e.attr("data-disabled",t?0:1)})})};function c(a){var e=ajaxify.data.category.cid;if(e){var t;if($(a).is(":checkbox")){t=$(a).is(":checked")?1:0}else{t=$(a).val()}o[e]=o[e]||{};o[e][$(a).attr("data-name")]=t;app.flags=app.flags||{};app.flags._unsaved=true}}function s(){var a=$("#tag-whitelist");a.tagsinput({confirmKeys:[13,44],trimValue:true});ajaxify.data.category.tagWhitelist.forEach(function(e){a.tagsinput("add",e)});a.on("itemAdded itemRemoved",function(){c(a)})}r.launchParentSelector=function(){var a=[parseInt(ajaxify.data.category.cid,10)];var e=ajaxify.data.allCategories.filter(function(e){var t=a.includes(parseInt(e.parentCid,10));if(t){a.push(parseInt(e.cid,10))}return e&&!e.disabled&&parseInt(e.cid,10)!==parseInt(ajaxify.data.category.cid,10)&&!t});i.modal(e,function(a){var e={};e[ajaxify.data.category.cid]={parentCid:a};socket.emit("admin.categories.update",e,function(e){if(e){return app.alertError(e.message)}var t=ajaxify.data.allCategories.filter(function(e){return e&&parseInt(e.cid,10)===parseInt(a,10)});t=t[0];$('button[data-action="removeParent"]').parent().removeClass("hide");$('button[data-action="setParent"]').addClass("hide");var i='<i class="fa '+t.icon+'"></i> '+t.name;$('button[data-action="changeParent"]').html(i).parent().removeClass("hide")})})};return r});
//# sourceMappingURL=category.js.map